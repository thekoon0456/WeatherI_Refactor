# ğŸŒ¤ï¸ ë‚ ì”¨ì˜ i
`ì‚¬ìš©ìê°€ ì„¤ì •í•œ ì‹œê°„ì— ë‚˜ë§Œì˜ ê¸°ìƒìºìŠ¤í„°ê°€ ì˜¤ëŠ˜ì˜ ë‚ ì”¨ë¥¼ ì•Œë ¤ì£¼ê³ , ë°”íƒ•í™”ë©´ì— ìœ„ì ¯ì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” ë‚ ì”¨ ì•±ì…ë‹ˆë‹¤.` <br>
`ê°œì¸ í”„ë¡œì íŠ¸, 2.1.1 ì—…ë°ì´íŠ¸ (UIKit, SwiftUI, MVVM)` <br>

> ë§¤ì¼ ì™¸ì¶œí•˜ëŠ” ì‹œê°„ì— ê°€ì¡±, ì—°ì¸, ìµœì• ê°€ ì˜¤ëŠ˜ì˜ ë‚ ì”¨ë¥¼ ì•Œë ¤ë“œë ¤ìš”!<br>
> ğŸŒ¤ï¸ ë‚ ì”¨ì˜ i ì™€ í•¨ê»˜ í•˜ëŠ” ì¥ë§ˆì² . ìš°ì‚°ë„ ìŠì§€ ë§ê³  ì±™ê²¨ìš”:)<br>
> ê¸°ìƒì²­ ì„œë²„ì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ í†µì‹ í•´ì„œ ì •í™•í•œ ë‚ ì”¨ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.<br>
<br>

## ğŸ”— Links
### [ğŸ“±Â AppStore](https://bit.ly/AppStore_WeatherI)
### [ğŸ’»Â GitHub](https://github.com/thekoon0456/WeatherI_Refactor)
### [ğŸ‘¨â€ğŸ’»Â Blog](https://thekoon0456.tistory.com/search/ë‚ ì”¨)
<br>

## ğŸ§‘ğŸ»â€ğŸ’» í•µì‹¬ í‚¤ì›Œë“œ

![iOS](https://img.shields.io/badge/iOS-000000?style=for-the-badge&logo=ios&logoColor=white)
![Swift](https://img.shields.io/badge/swift-F54A2A?style=for-the-badge&logo=swift&logoColor=white)
![UIKit](https://img.shields.io/badge/UIkit-2396F3?style=for-the-badge&logo=UIKit&logoColor=white)
![SwiftUI](https://img.shields.io/badge/SwiftUI-000000?style=for-the-badge&logo=Swift&logoColor=blue)
![Xcode](https://img.shields.io/badge/Xcode-007ACC?style=for-the-badge&logo=Xcode&logoColor=white)

![Realm](https://img.shields.io/badge/realm-39477F?style=for-the-badge&logo=Realm&logoColor=white)
![SnapKit](https://img.shields.io/badge/SnapKit-4285F4?style=for-the-badge&logo=SnapKit&logoColor=white)
![NotificationContentsExtension](https://img.shields.io/badge/NotificationContentsExtension-000000?style=for-the-badge&logo=NotificationContentsExtension&logoColor=white)
<br>
<br>

## ğŸ“Œ ì£¼ìš” ê¸°ëŠ¥
- ê¸°ìƒì²­, ì—ì–´ì½”ë¦¬ì•„ ê³µê³µë°ì´í„° API ì—°ë™: ë‹¨ê¸° ì˜ˆë³´ì¡°íšŒ, ì¤‘ê¸° ìœ¡ìƒ ì˜ˆë³´ ì¡°íšŒ, ì¤‘ê¸° ê¸°ì˜¨ ì¡°íšŒ, ì‹œë„ë³„ ë¯¸ì„¸ë¨¼ì§€ ì‹¤ì‹œê°„ í‰ê·  ì •ë³´ ì¡°íšŒ. ì´ 4ê°€ì§€ API ë™ì‹œ ì²˜ë¦¬
- í•œ ëˆˆì— ë“¤ì–´ì˜¤ëŠ” ë‚ ì”¨ ë°ì´í„°: í˜„ì¬ ë‚ ì”¨, ë¯¸ì„¸ë¨¼ì§€ ìƒíƒœ, ìƒì„¸ ë‚ ì”¨, ì‹œê°„ë³„ ë‚ ì”¨, ì£¼ê°„ ë‚ ì”¨ ë“± ë‹¤ì–‘í•œ ë‚ ì”¨ì •ë³´ ì œê³µ
- ì•„ë¦„ë‹¤ìš´ ë°°ê²½í™”ë©´: ë‚ ì”¨, ì‹œê°„ì— ë”°ë¼ ì–´ìš¸ë¦¬ëŠ” ë‹¤ì–‘í•œ ë°°ê²½í™”ë©´ ì œê³µ
- ì•Œë¦¼ ê¸°ëŠ¥: NotificationContentsExtensionë¥¼ í™œìš©í•´ ìœ ì €ê°€ ì„¤ì •í•œ ì‹œê°„ì— ì˜¤ëŠ˜ì˜ ë‚ ì”¨ì •ë³´ë¥¼ ì œê³µ
- ì»¤ìŠ¤í…€ ì•Œë¦¼ ë·°: ì‚¬ìš©ìê°€ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì„ ë‚ ì”¨ìš”ì •ìœ¼ë¡œ ì„¤ì •í•˜ê³ , ì‚¬ì§„ê³¼ í•¨ê»˜ ë‚ ì”¨ë°ì´í„°ë¥¼ ë°›ìŒ
- ë‚ ì”¨ ì•„ì´í…œ ì¶”ì²œ: ìš°ì‚°, ëª¨ì, ì„ í¬ë¦¼ ë“± ì˜¤ëŠ˜ ë‚ ì”¨ì— í•„ìš”í•œ ì•„ì´í…œ ì¶”ì²œ
- ë°ì´í„° ìƒˆë¡œê³ ì¹¨: ì•±ì´ backgroundì—ì„œ ë‹¤ì‹œ foregroundë¡œ ì§„ì… ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨, ì•„ë˜ë¡œ ë‹¹ê²¨ ìœ ì €ê°€ ì›í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ê°€ëŠ¥
- ì• ë‹ˆë©”ì´ì…˜ ë·°: ì˜¨ ë³´ë”©, ë¡œë”© í™”ë©´ ë“± ë¡œí‹°ë¥¼ í™œìš©í•œ ë‹¤ì–‘í•œ ì• ë‹ˆë©”ì´ì…˜ ë·° ì œê³µ 
<br>

## ğŸ“±ì‹œì—° ì˜ìƒ
|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/e2310b70-0b10-4c95-b161-731807d37950"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/87b36b00-853f-4ee3-843d-70c24fe81649"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/a0107164-28f7-416d-863a-2241aa12e7c3"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/fd86103e-c18d-4338-9d34-41dcbf62aff8"></img>|
|:-:|:-:|:-:|:-:|
|`ì•Œë¦¼ ë·°`|`ë©”ì¸ ë·°`|`ìœ„ì ¯ ë·°`|`ì˜¨ë³´ë”© ë·°`|
|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/e863ab80-ea5a-43c9-a999-19d638d2a5c3"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/fd86103e-c18d-4338-9d34-41dcbf62aff8"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/d031ed7e-d037-4267-992e-ddca6cf91cb4"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/bddfaf18-1453-4b21-8d60-5e000e247be9"></img>|
|`ì„¤ì • ë·°`|`ì›¹, ë©”ì¼ ë·°`|`ê¾¸ì¤€í•œ ì—…ë°ì´íŠ¸`|`ê¸ì •ì  ë¦¬ë·°`|
<br>

## âœ… íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
### ë‚ ì”¨ API ì±„íƒí•˜ê¸°
<div markdown="1">
        
```
Appleì˜ WeatherKitê³¼ ê¸°ìƒì²­ APIë¥¼ ë¹„êµí•˜ê³ , ê¸°ìƒì²­ APIë¥¼ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

Apple WeatherKitëŠ” í¸ë¦¬í–ˆìŠµë‹ˆë‹¤.
Appleì´ ë§Œë“¤ì–´ë†“ì€ APIë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ê³ , ì „ ì„¸ê³„ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆì—ˆì§€ë§Œ,
ì‚¬ìš©í•˜ëŠ” ë‚ ì”¨ ë°ì´í„°ê°€ í•œêµ­ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ìƒì²­ì˜ ë°ì´í„°ì™€ ì¡°ê¸ˆì”© ë‹¬ëìŠµë‹ˆë‹¤. 

ë°˜ë©´ì— ê¸°ìƒì²­ì˜ APIëŠ” ì ìš©í•˜ê¸°ì— ë¶ˆí¸í•œ ë©´ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
ì˜¤ëŠ˜ì˜ ë‚ ì”¨, ë¯¸ì„¸ë¨¼ì§€, ì£¼ê°„ ì˜¨ë„, ì£¼ê°„ ë‚ ì”¨ ë“± ë„¤ ê°€ì§€ì˜ ë‹¤ë¥¸ APIë¥¼ ì‚¬ìš©í•´ì•¼ í–ˆê³ , ì¶”ê°€ì ì¸ ë°ì´í„° ê°€ê³µë„ ë§ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.
ì €ëŠ” ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ê°€ê³µí•˜ë©° ê¸°ìˆ ì ì¸ ì—­ëŸ‰ì„ ëŠ˜ë¦¬ê¸° ìœ„í•´ ë¶ˆì¹œì ˆí•˜ì§€ë§Œ ë³´í¸ì ì¸ ê¸°ìƒì²­ APIë¥¼ ì±„íƒí–ˆìŠµë‹ˆë‹¤.
```

```swift
//ì˜¤ëŠ˜ì˜ ë‚ ì”¨ ë°ì´í„°ë¥¼ URLSessionìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë©”ì„œë“œ

func performRequest<T>(completion: @escaping (Result<[T], NetworkError>) -> (Void)) {
    setNxNy(nx: LocationService.shared.latitude ?? 0, ny: LocationService.shared.longitude ?? 0)
    guard let url = URL(string: weatherURL) else { return }
    
    let session = setCustomURLSession(retryRequest: DoubleConstant.networkRequest.rawValue)
    session.dataTask(with: url) { [weak self] data, response, error in
        guard let self else { return }
        if error != nil {
            print("ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ \(String(describing: error?.localizedDescription))")
            completion(.failure(.networkingError))
            retryRequest(completion: completion)
            return
        }
            
        guard let data = data else {
            print("ë°ì´í„° ì—ëŸ¬")
            completion(.failure(.dataError))
            retryRequest(completion: completion)
            return
        }

        if let item = parseWeatherJSON(data) as? [T] {
            print("Weather JSON íŒŒì‹± ì„±ê³µ")
            completion(.success(item))
        } else {
            retryRequest(completion: completion)
            completion(.failure(.parseError))
        }
    }.resume()
}
```
</div>
<br>

### ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ê³ , í˜„ì¬ ìœ„ì¹˜ì˜ ë‚ ì”¨ ìš”ì²­
<div markdown="1">
        
```
CoreLocationì„ í™œìš©í•´ ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„, ê²½ë„ë¥¼ íŒŒì•…í•˜ê³ , íŒŒì•…í•œ ì¢Œí‘œë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ìƒì²­ ì„œë²„ì— ì¿¼ë¦¬ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.

LocationServiceë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ë§Œë“¤ì–´ ì•± ì§„ì… ì‹œì ì—ì„œ ì‚¬ìš©ìì˜ ìœ„, ê²½ë„ë¥¼ ì–»ì–´ì˜¤ê³ , ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. 
í•˜ì§€ë§Œ ë‚ ì”¨ ë°ì´í„°ê°€ ì •í™•í•˜ì§€ ì•Šì•˜ê³ , CoreLocationì—ì„œ êµ¬í•œ ìœ„, ê²½ë„ë¥¼ ê¸°ìƒì²­ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë…ìì ì¸ X, Yì¢Œí‘œë¡œ ë³€í™˜í•œ í›„ì— ì •í™•í•œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

ë˜í•œ CLGeocoder()ì˜ placemarksë¥¼ ìš”ì²­í•´ ì•±ì—ì„œ í™”ë©´ì— í‘œì‹œí•  ì£¼ì†Œë¥¼ ê°€ì ¸ì™”ëŠ”ë°, êµ¬ ì£¼ì†Œì™€ ë„ë¡œëª… ì£¼ì†Œê°€ ëœë¤í•˜ê²Œ ê°€ì ¸ì™€ì ¸ì„œ ë‘ ê°€ì§€ ê²½ìš°ë¥¼ ëª¨ë‘ ê³ ë ¤í•´ ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
```

```swift
// ê¸°ìƒì²­ ì¢Œí‘œì™€ ì£¼ì†Œë¥¼ êµ¬í•´ì˜¤ëŠ” ì½”ë“œ

func locationToString(location: CLLocation, completion: @escaping () -> (Void)) {
    let geocoder = CLGeocoder()
    geocoder.reverseGeocodeLocation(
        location,
        preferredLocale: self.locale
    ) { [weak self] placemarks, _ in
        guard
            let self = self,
            let placemarks = placemarks
        else { return }
        print("DEBUG: í˜„ì¬ ìœ„ì¹˜ëŠ” \(location)ì…ë‹ˆë‹¤.")
        
        //ì£¼ì†Œê°€ êµ¬ ì£¼ì†Œì¼ë•Œ
        if let locality = placemarks.last?.locality,
            let subLocality =  placemarks.last?.subLocality,
            let administrative = placemarks.last?.administrativeArea {
            userRegion = locality + " " + subLocality
            localityRegion = locality
            subLocalityRegion = subLocality
            administrativeArea = administrative
            print("DEBUG: í˜„ì¬ ì£¼ì†ŒëŠ” êµ¬ ì£¼ì†Œ: \(String(describing: userRegion))ì…ë‹ˆë‹¤.")
        }
        
        //ì£¼ì†Œê°€ ë„ë¡œëª… ì£¼ì†Œì¼ë•Œ
        if let administrative = placemarks.first?.administrativeArea,
            let name = placemarks.first?.name {
            userRegion = administrative + " " + name
            administrativeArea = administrative
            print("DEBUG: í˜„ì¬ ì£¼ì†ŒëŠ” ë„ë¡œëª…: \(String(describing: userRegion))ì…ë‹ˆë‹¤.")
        }
        
        // ê°€ì ¸ì˜¨ ìœ„, ê²½ë„ë¥¼ ê¸°ìƒì²­ì˜ x, y ì¢Œí‘œë¡œ ë³€í™˜
        let convertedXy = LocationService.shared.convertGRID_GPS(lat_X: latitude ?? 0, lng_Y: longitude ?? 0)
        convertedX = convertedXy.x
        convertedY = convertedXy.y
        print("converted: \(convertedX), \(convertedY)")
        
        //MARK: - Widgetì— ë³´ë‚´ì£¼ëŠ” ë°ì´í„°ë“¤
        UserDefaults.shared.set(convertedX, forKey: "convertedX")
        UserDefaults.shared.set(convertedY, forKey: "convertedY")
        UserDefaults.shared.set(administrativeArea, forKey: "administrativeArea")
        completion()
    }
}
```
</div>
<br>

### ë°ì´í„° ë¡œë”© í™”ë©´, ì˜¨ ë³´ë”© í™”ë©´ì—ì„œ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
<div markdown="1">
        
```
ì•±ì„ ì²˜ìŒ ì„¤ì¹˜í•˜ê³  ì˜¨ ë³´ë”© ë·°ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë™ì•ˆ ì‚¬ìš©ìì˜ ì‹œì‘ì ì¸ ì¦ê±°ì›€ì„ ìœ„í•´ Lottieë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤.
ë„¤ ê°€ì§€ì˜ ë‹¤ë¥¸ APIë¥¼ ë™ì‹œì— ê°€ì ¸ì˜¤ê¸° ìœ„í•´ DispatchGroupì„ ì‚¬ìš©í–ˆìœ¼ë©°
completionì´ ë˜ê¸° ì „ê¹Œì§€ Lottie Animationì„ ì‹¤í–‰ë˜ë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
```

```swift
//ê°ê¸° ë‹¤ë¥¸ API í˜¸ì¶œí•˜ê³ , ì™„ë£Œë˜ë©´ Lottie Animation ì¢…ë£Œ

func loadData(completion: @escaping () -> Void) {
    let dispatchGroup = DispatchGroup()
    
    dispatchGroup.enter()
    viewModel.loadTodayWeather { [weak self] model in
        guard let self = self else { return }
        todayWeather = model
        print("DEBUG: loadTodayWeather ì™„ë£Œ")
        dispatchGroup.leave()
    }
    
    dispatchGroup.enter()
    viewModel.loadTodayDetailWeather { [weak self] model in
        guard let self = self else { return }
        todayDetailWeather = model
        print("DEBUG: loadTodayDetailWeather ì™„ë£Œ")
        dispatchGroup.leave()
    }
        
    dispatchGroup.enter()
    dustViewModel.loadTodayDust { [weak self] model in
        guard let self = self else { return }
        todayDust = model
        print("DEBUG: loadTodayDust ì™„ë£Œ")
        dispatchGroup.leave()
    }
    
    dispatchGroup.enter()
    viewModel.loadWeeklyWeather { [weak self] model in
        guard let self = self else { return }
        weeklyWeather = model
        print("DEBUG: loadWeeklyWeather ì™„ë£Œ")
        dispatchGroup.leave()
    }
    
    dispatchGroup.enter()
    viewModel.loadWeeklyWeatherTemp { [weak self] model in
        guard let self = self else { return }
        weeklyWeatherTemp = model
        print("DEBUG: loadWeeklyWeatherTemp ì™„ë£Œ")
        dispatchGroup.leave()
    }
    
    dispatchGroup.notify(queue: .main) {
        print("DEBUG: loadDataì™„ë£Œ")
        
        //Lottie ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ
        completion()
    }
}
```
</div>
<br>

### ë¡œì»¬ ì•Œë¦¼ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë³´ë‚´ë©´ì„œ ì„œë²„ì™€ í†µì‹ í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ëŠ” ë¬¸ì œ
<div markdown="1">
        
```
ë°±ì—”ë“œ ì„œë²„ë¥¼ ë”°ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ì´ì—ˆê¸° ë•Œë¬¸ì— ë¡œì»¬ ì•Œë¦¼ìœ¼ë¡œ ì˜¤ëŠ˜ ë‚ ì”¨ ì•Œë¦¼ì„ êµ¬í˜„í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
ë¡œì»¬ ì•Œë¦¼ì—ì„œ ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ ë°›ëŠ” ì‹œì ì—ì„œ ì„œë²„ì™€ í†µì‹ í•œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—
Appì—ì„œ ë‚ ì”¨ ì•Œë¦¼ì„ ë“±ë¡í•  ë•Œ UNCalendarNotificationTriggerì™€ UNMutableNotificationContentë¥¼ í™œìš©í•´ ì•Œë¦¼ì„ ì„¤ì •í•œ ì‹œê°„ì— íŠ¸ë¦¬ê±°ë¥¼ ë³´ë‚´ê³ ,
NotificationContentsExtensionë¥¼ í™œìš©í•´ì„œ ì•Œë¦¼ì„ ê¾¹ ëˆŒë €ì„ ë•Œ ì„œë²„ì— ë‚ ì”¨ë¥¼ ìš”ì²­í•˜ë„ë¡ ì»¤ìŠ¤í…€ ì•Œë¦¼ í™”ë©´ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
```

```swift
//UNNotificationì„ ë°›ì•„ ì•Œë¦¼ í™”ë©´ì— êµ¬í˜„í•˜ëŠ” ì½”ë“œ

func didReceive(_ notification: UNNotification) {
    
    //ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€ë¥¼, ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì•Œë¦¼ì°½ì— í‘œì‹œ
    if let image = realmData.first?.alertImage {
        profileImageView.image = UIImage(data: image)
    } else {
        profileImageView.image = defaultImage()
    }
    
    guard
        let userInfo = notification.request.content.userInfo as? [String: Any],
        let alertName = userInfo["alertName"] as? String
    else { return }
    
    //ë°ì´í„°ë¥¼ ìš”ì²­
    loadData { [weak self] in
        guard let self = self else { return }
        DispatchQueue.main.async { [weak self] in
            guard let self = self else { return }
            //ë°ì´í„° ìš”ì²­ì´ ì™„ë£Œë˜ë©´ UIë¥¼ êµ¬ì„±í•˜ê³ , Animation ì¢…ë£Œí•©ë‹ˆë‹¤.
            updateUI(userName: alertName)
            stopAnimation()
        }
    }
}
```
</div>
<br>

### SwiftUIë¡œ Widgetêµ¬ì„±í•˜ê³ , ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ì— ì£¼ê¸°ì ìœ¼ë¡œ API ìš”ì²­
<div markdown="1">
        
```
ë‚ ì”¨ ì•±ì„ ê¸°íší•  ë•Œë¶€í„° ìœ„ì ¯ì€ í•„ìˆ˜ë¡œ êµ¬í˜„í•˜ê¸°ë¡œ ìƒê°í–ˆì—ˆìŠµë‹ˆë‹¤.
SwiftUIì˜ WidgetKitìœ¼ë¡œ ìœ„ì ¯ì„ êµ¬í˜„í•˜ê³ , ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ì™€ í†µì‹ ì„ í•˜ê³  í™”ë©´ì„ ìƒˆë¡œ ê³ ì¹  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
getData ë©”ì„œë“œë¡œ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•˜ê³  widgetDataë¥¼ ë°›ì•„ì™€ ìœ„ì ¯ í™”ë©´ì— í•„ìš”í•œ viewModelì„ ë§Œë“¤ê³ 
getTimeline í•¨ìˆ˜ ë‚´ì—ì„œ nextRefreshë¥¼ ë§Œë“¤ì–´ 1ì‹œê°„ë§ˆë‹¤ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
```

```swift
//1ì‹œê°„ì— 1ë²ˆì”© ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•˜ê³  ë°›ì•„ì˜¨ ë°ì´í„°ë¡œ ìœ„ì ¯ ì—…ë°ì´íŠ¸

func getTimeline(in context: Context, completion: @escaping (Timeline<WeatherEntry>) -> ()) {
    getData { [weak self] widgetData in
        guard let self else { return }
        
        let todayWeatherLabel = getTodayState(model: widgetData)
        let todayWeatherIconName = getTodayIconName(model: widgetData)
        let todayTemp = getTemp(model: widgetData)
        let todayPop = getPop(model: widgetData)
        let todayBackgroundImage = getHomeViewBackgroundImage(model: widgetData)
        
        var widgetViewModel = WidgetViewModl(todayWeatherLabel: todayWeatherLabel,
                                            todayWeatherIconName: todayWeatherIconName,
                                            todayTemp: todayTemp,
                                            todayPop: todayPop,
                                            todayBackgroundImage: todayBackgroundImage)
    
        let currentDate = Date()
        let nextRefresh = Calendar.current.date(byAdding: .hour,
                                                value: 1,
                                                to: currentDate) ?? Date()
        
        let entry = WeatherEntr(date: currentDate,
                                data: widgetViewModel)
        
        let timeline = Timeline(entries: [entry], policy: .after(nextRefresh))
        print("DEBUG: timeline: \(timeline)")
        completion(timeline)
    }
}
```
</div>
<br>

### ë°ì´í„°ë¥¼ CRUDí•˜ê³  AppExtensionì—ì„œë„ ë™ì¼í•œ ë°ì´í„° í™œìš©í•˜ê¸°
<div markdown="1">
        
```
realm ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•´ì„œ ì•±ì˜ CRUDë¥¼ êµ¬í˜„í•˜ê³ , ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í†µí•´ ì—¬ëŸ¬ AppExtensionì—ì„œ í™œìš©í–ˆìŠµë‹ˆë‹¤.

í”„ë¡œí† íƒ€ì…ì—ì„œëŠ” Appleì˜ í”„ë ˆì„ì›Œí¬ì¸ CoreDataë¥¼ í™œìš©í•´ì„œ CRUDë¥¼ êµ¬í˜„í–ˆì§€ë§Œ, ë³µì¡í•œ ë°ì´í„°ë¥¼ ë‹¤ë£¨ê¸°ì— ë¶ˆí¸í•¨ì´ ìˆì–´ realmìœ¼ë¡œ ë¦¬íŒ©í† ë§í•´ CRUDë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
ì»¤ìŠ¤í…€ ì•Œë¦¼ê³¼ ìœ„ì ¯ì„ êµ¬í˜„í•˜ë©´ì„œ AppExtensionì¸ NotificationContentsExtensionê³¼ WidgetExtensionì—ì„œ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° 
realmì—ì„œ ì €ì¥í•œ ë°ì´í„°ë¥¼ AppDelegateì—ì„œ RealmContainerë¡œ ë§Œë“¤ì–´ì„œ AppExtensionì—ì„œë„ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì ‘ê·¼í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
```

```swift
//RealmContainerë¥¼ ë§Œë“¤ì–´ì„œ ë‹¤ì–‘í•œ AppExtensionì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„

func setRealmContainer() {
    let defaultRealm = Realm.Configuration.defaultConfiguration.fileURL!
    let container = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: "group.weatherI.widget")
    let realmURL = container?.appendingPathComponent("default.realm")
    var config: Realm.Configuration!
    
    if FileManager.default.fileExists(atPath: defaultRealm.path) {
        do {
            _ = try FileManager.default.replaceItemAt(realmURL!, withItemAt: defaultRealm)
            config = Realm.Configuration(fileURL: realmURL, schemaVersion: 1)
        } catch {
            print("DEBUG: Error setRealmContainer: \(error)")
        }
    } else {
        config = Realm.Configuration(fileURL: realmURL, schemaVersion: 1)
    }
    
    Realm.Configuration.defaultConfiguration = config
}
```
</div>
<br>

### ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì‚¬ì§„ì„ ì„¤ì •í•˜ë©´ ì•±ì—ì„œëŠ” ì‚¬ì§„ì´ ì‚­ì œë˜ì§€ë§Œ ì‹œìŠ¤í…œ í´ë”ì— ê³„ì† ìš©ëŸ‰ì´ ìŒ“ì´ëŠ” ë¬¸ì œ
<div markdown="1">
        
```
Notificationê³¼ Widgetì—ì„œ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì‚¬ì§„ì„ ì„¤ì •í•˜ë©´ ì•± ë‚´ì—ì„œëŠ” ê¸°ì¡´ì˜ ì‚¬ì§„ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œìš´ ì‚¬ì§„ìœ¼ë¡œ ëŒ€ì²´í–ˆì§€ë§Œ
ì‹œìŠ¤í…œ í´ë”ì˜ TEMP í´ë”ì— ê¸°ì¡´ì˜ ì‚¬ì§„ì´ ê³„ì† ìŒ“ì—¬ì„œ ë¶ˆí•„ìš”í•˜ê²Œ ì•±ì˜ ìš©ëŸ‰ì´ ëŠ˜ì–´ë‚˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

FileManagerì™€ NSTemporaryDirectoryë¥¼ í™œìš©í•´ì„œ ì•±ì„ ì¢…ë£Œí•  ë•Œë§ˆë‹¤ TEMP í´ë”ì— ìˆëŠ” ì‚¬ì§„ì„ ì‚­ì œí•˜ë„ë¡ êµ¬í˜„í–ˆê³ 
 ë¶ˆí•„ìš”í•˜ê²Œ ì•±ì˜ ìš©ëŸ‰ì´ ì»¤ì§€ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
```

```swift
//ì•± ì¢…ë£Œì‹œ ì„ì‹œíŒŒì¼ ì‚­ì œ ë©”ì„œë“œ

func deleteFilesInTmpDirectory() {
    let fileManager = FileManager.default
    let tmpDirectory = NSTemporaryDirectory()
    
    do {
        let tmpContents = try fileManager.contentsOfDirectory(atPath: tmpDirectory)
        for file in tmpContents {
            let filePath = (tmpDirectory as NSString).appendingPathComponent(file)
            try fileManager.removeItem(atPath: filePath)
            print("ì‚­ì œëœ ì„ì‹œ íŒŒì¼: \(filePath)")
        }
    } catch {
        print("DEBUG: TMP í´ë” ì‚­ì œ Error - \(error.localizedDescription)")
    }
}

// ì•± ì¢…ë£Œì‹œ SceneDelegateì—ì„œ ìœ„ì ¯ ì—…ë°ì´íŠ¸ì™€ ì„ì‹œíŒŒì¼ ì‚­ì œ

func sceneWillResignActive(_ scene: UIScene) {
    // ìœ„ì ¯ ì—…ë°ì´íŠ¸ ìš”ì²­ ë³´ë‚´ê¸°
    WidgetCenter.shared.reloadTimelines(ofKind: "com.thekoon.NotiWeather")
        
    // ì•± ì¢…ë£Œì‹œ ì„ì‹œíŒŒì¼ ì‚­ì œ
    deleteFilesInTmpDirectory()
}
```
</div>
<br>

## ğŸ“‚ í´ë” íŠ¸ë¦¬
<details>
<summary>í´ë” íŠ¸ë¦¬ ì—´ì–´ë³´ê¸° </summary>
<div markdown=â€œ1â€>
<pre>
// MVVM íŒ¨í„´ì˜ êµ¬ì¡°ì— ë”°ë¼ Entity -> Respository -> Models -> Service -> ViewModels -> Views ì˜ ë‹¨ë°©í–¥ ë°ì´í„° íë¦„ êµ¬í˜„

AlarmWeather/
â”œâ”€ AppDelegate.swift
â”œâ”€ SceneDelegate.swift
â”œâ”€ ScaledImage.swift
â”œâ”€ ğŸ“‚ Entity/
â”‚  â”œâ”€ WeatherEntity.swift
â”‚  â”œâ”€ WeeklyWeatherEntity.swift
â”‚  â”œâ”€ WeeklyWeatherTempEntity.swift
â”‚  â”œâ”€ DustEntity.swift
â”‚  â”œâ”€ HomeView.swift
â”‚  â””â”€ UserEntity.swift
â”‚  
â”œâ”€ ğŸ“‚ Respository/
â”‚  â”œâ”€ WeatherRepository.swift
â”‚  â”œâ”€ WeeklyWeatherRepository.swift
â”‚  â”œâ”€ WeeklyWeatherTempRepository.swift
â”‚  â””â”€ DustRepository.swift
â”‚  
â”œâ”€ ğŸ“‚ Models/
â”‚  â”œâ”€ WeatherModel.swift
â”‚  â”œâ”€ WeeklyWeatherModel.swift
â”‚  â”œâ”€ WeeklyWeatherTempModel.swift
â”‚  â””â”€ DustModel.swift
â”‚  
â”œâ”€ ğŸ“‚ Service/
â”‚  â”œâ”€ WeatherService.swift
â”‚  â”œâ”€ WeeklyWeatherService.swift
â”‚  â”œâ”€ WeeklyWeatherTempService.swift
â”‚  â”œâ”€ DustService.swift
â”‚  â”œâ”€ UserService.swift
â”‚  â”œâ”€ LocationService.swift
â”‚  â””â”€ AlertService.swift
â”‚  
â”œâ”€ ğŸ“‚ ViewModels/
â”‚  â”œâ”€ HomeViewModel.swift
â”‚  â”œâ”€ DustViewModel.swift
â”‚  â”œâ”€ SettingProfileViewModel.swift
â”‚  â””â”€ TextFieldViewModel.swift
â”‚ 
â”œâ”€ ğŸ“‚ Views/
â”‚  â”œâ”€ WetherAndDustStackView.swift
â”‚  â”œâ”€ TodayWeatherCell.swift
â”‚  â”œâ”€ TodayDetailWeatherCell.swift
â”‚  â”œâ”€ WeeklyWeatherCell.swift
â”‚  â”œâ”€ SettingCell.swift
â”‚  â”œâ”€ AlertTimeCell.swift
â”‚  â”œâ”€ CustomTextField.swift
â”‚  â””â”€ SaveButton.swift
â”‚  
â”œâ”€ ğŸ“‚ Controllers/
â”‚  â”œâ”€ OnboardingViewController.swift
â”‚  â”œâ”€ OnboardingContentViewController.swift
â”‚  â”œâ”€ RootViewController.swift
â”‚  â”œâ”€ HomeController.swift
â”‚  â”œâ”€ WeatherController.swift
â”‚  â”œâ”€ DustController.swift
â”‚  â”œâ”€ SettingController.swift
â”‚  â”œâ”€ UpdateSettingViewController.swift
â”‚  â””â”€ SettingAddAlertViewController.swift
â”‚  
â”œâ”€ ğŸ“‚ Utils/
â”‚  â”œâ”€ Constant.swift
â”‚  â””â”€â”€ Extention.swift
â”‚  â”œâ”€ ğŸ“‚ Lottie/
â”‚  â”‚  â””â”€ loading.json
â”‚  â”‚  â””â”€ location.json
â”‚  â”‚  â””â”€ addUser.json
â”‚  â””â”€â”€â”€â”€ notification.json
â”‚  
â””â”€â”€ ğŸ“‚ NotificationContentsExtension/
â””â”€â”€ ğŸ“‚ WidgetExtension/
</pre>
</div>
</details>
<br>

## ğŸ’» ì•± ê°œë°œ í™˜ê²½

- ìµœì†Œ ì§€ì› ë²„ì „: iOS 15.0+
- Xcode Version 14.3.1 (14E300c)
- iPhone 14 Pro, iPhone 14 Pro + ì—ì„œ ìµœì í™”ë¨, iPhone SE3ê¹Œì§€ í˜¸í™˜ ê°€ëŠ¥
- ë‹¤í¬ëª¨ë“œ ì§€ì›, ê°€ë¡œëª¨ë“œ ë¯¸ì§€ì›
<br>
